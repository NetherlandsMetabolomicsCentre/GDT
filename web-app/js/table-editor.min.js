function TableEditor(){}TableEditor.prototype={options:{tableIdentifier:"div.table",headerIdentifier:"div.header",rowIdentifier:"div.row",columnIdentifier:"div.column, div.firstColumn",initialize:0,minRowSliderCount:20,scrollTimeout:200,snapHeader:true,verticalSlider:true},allSelected:false,tables:[],date:new Date(),timed:null,window:$(window),document:$(document),scrollTop:0,actionCallback:[],init:function(a){var b=this;if(a){$.each(a,function(c,d){b.options[c]=d})}$(this.options.tableIdentifier).each(function(){var c=$(this);b.initializeTable(c);b.tables[b.tables.length]=c});if(b.tables.length&&b.options.snapHeader){b.window.scroll(function(){if(b.timed){clearTimeout(b.timed)}if($.browser.msie){b.timed=setTimeout(function(){b.onScrollEnd()},b.options.scrollTimeout)}else{b.timed=setTimeout(function(c){c.onScrollEnd()},b.options.scrollTimeout,b)}})}return this},onScrollEnd:function(){var j=this;var b=this.date.getTime();var m=this.window.scrollTop();var a=m+this.window.height();var n=(m>this.scrollTop)?"down":"up";if(m>this.scrollTop||m<this.scrollTop){this.scrollTop=m;for(var e in j.tables){var p=j.tables[e];var d=p.offset();var o=d.top;var c=o+p.height();var f=$(j.options.headerIdentifier,p);if(o<=a&&c>=m){var l=null;var h=0;var k=0;var g=0;$(j.options.rowIdentifier+", "+j.options.headerIdentifier,p).each(function(){var r=$(this);var i=r.offset().top;var q=i+r.height();g++;if(!l&&((i>=m&&i<=a))){l=r;h=g}if(r[0]==f[0]){k=g}});if(l){if(k==h){}else{if(k>h){l.before(f);if(j.options.verticalSlider){j.repositionVerticalSlider(p,f)}}else{if(k<h){l.after(f);if(j.options.verticalSlider){j.repositionVerticalSlider(p,f)}}}}}}}}},repositionVerticalSlider:function(b,c){var a=b.prev();a.animate({top:c.offset().top},200)},initializeTable:function(b){var a=this;this.attachInputElements(b);if($.browser.mozilla){b.bind("click",function(h){var i=h.target;var e=$(i);var g=i.localName;var c=(g=="option")?$(i.parentNode):e;var d=c.attr("type");var f=c.parent();var j=f.parent();if(g=="option"){a.replicateData(b,j,f,c.attr("type"),i.value)}else{if(d=="checkbox"){a.replicateData(b,j,f,c.attr("type"),i.checked)}}})}b.selectable({filter:a.options.rowIdentifier,selected:function(c,d){a.cleanup(b);a.attachSelectElementsInRow(b,d.selected);if(!$.browser.mozilla){a.attachCheckboxElementsInRow(b,d.selected)}a.attachDatepickerOnChangeInRow(b,d.selected)},unselected:function(c,d){a.cleanup(b);if(!$.browser.mozilla){a.detachColumnHandler(d.unselected)}}});this.addSelectAllButton(b);this.resizeTableColumns(b);this.attachActionHandlers(b)},registerActionCallback:function(a,b){this.actionCallback[a]=b},attachActionHandlers:function(b){var a=this;$("[action]",b).each(function(){var c=$(this);var d=(c.attr("identifier"))?c.attr("identifier"):"";c.bind("click",function(){a.handleAction(c.attr("action"),d,b)})})},handleAction:function(f,e,c){var a=[];var b=false;var d=this.actionCallback[f];$(".ui-selected, .table-editor-selected",c).each(function(){var h=$(this);var g=h.attr("identifier");if(g){a[a.length]=g;if(g==e){b=true}}});if(d){if(a.length&&b){d.call(a)}else{if(e){d.call([e])}}}},attachInputElements:function(b){var a=this;b.bind("keyup.tableEditor",function(h){var c=$("input:focus,select:focus");var f=c.attr("type");if(c.attr("type")){var d=c.parent();var i=c.parent().parent();var g=c.val();a.replicateData(b,i,d,f,g)}})},attachSelectElementsInRow:function(b,c){var a=this;$("select",c).each(function(){var d=$(this);var f="select";var e=d.parent();var g=d.parent().parent();d.bind("change.tableEditor",function(){var h=$("option:selected",d).val();if(h){a.replicateData(b,g,e,f,h)}})})},attachCheckboxElementsInRow:function(b,c){var a=this;$("input:checkbox",c).each(function(){var d=$(this);var f="checkbox";var e=d.parent();var g=d.parent().parent();d.bind("click.tableEditor",function(){a.replicateData(b,g,e,f,d.is(":checked"))})})},attachDatepickerOnChangeInRow:function(b,c){var a=this;$("input[type=text][rel$='date'], input[type=text][rel$='datetime']",c).each(function(){var d=$(this);var f=d.attr("type");var e=d.parent();var g=d.parent().parent();d.bind("change.tableEditor",function(){a.replicateData(b,g,e,f,d.val())})})},detachColumnHandler:function(a){$("select",a).each(function(){$(this).unbind(".tableEditor")})},getColumnNumber:function(d,b){var c=0;var a=0;d.children().each(function(){var e=$(this);if(e[0]==b[0]){a=c}c++});return a},replicateData:function(h,i,c,e,g){var d=this;var a=this.getColumnNumber(i,c);var f="";switch(e){case ("text"):f="input";break;case ("select"):case ("select-one"):f="select";break;case ("checkbox"):f="input:checkbox";break;default:f="input";break}if(f=="select"){var b=$(f,$(d.options.columnIdentifier,i)[a])[0].selectedIndex}if(i.hasClass("ui-selected")||i.hasClass("table-editor-selected")){$(".ui-selected, .table-editor-selected",h).each(function(){if($(this)[0]!=i[0]){$(f,$(d.options.columnIdentifier,$(this))[a]).each(function(){switch(e){case ("checkbox"):$(this).attr("checked",g);break;case ("select"):$(this)[0].options[b].selected=true;break;default:$(this).val(g);break}})}})}},addSelectAllButton:function(c){var b=this;var a=$($(this.options.headerIdentifier+":eq(0)",c).find(":nth-child(1)")[0]);if(a){a.addClass("selectAll").html("&nbsp;&nbsp;&nbsp;").bind("mousedown",function(){b.selectAll(c)});a.qtip({content:"leftMiddle",position:{corner:{tooltip:"leftMiddle",target:"rightMiddle"}},style:{border:{width:5,radius:10},padding:10,textAlign:"center",tip:true,name:"blue"},content:"Click to select all rows in this table",show:"mouseover",hide:"mouseout",api:{beforeShow:function(){}}})}},selectAll:function(b){var a=this;this.cleanup(b);$(this.options.rowIdentifier,b).each(function(){var c=$(this);c.addClass("table-editor-selected");if(!$.browser.mozilla){a.attachSelectElementsInRow(b,c);a.attachCheckboxElementsInRow(b,c)}});this.allSelected=true},cleanup:function(a){if(this.allSelected){this.deselectAll(a)}},deselectAll:function(b){var a=this;$(this.options.rowIdentifier,b).each(function(){var c=$(this);c.removeClass("table-editor-selected");if(!$.browser.mozilla){a.detachColumnHandler(c)}});this.allSelected=false},resizeTableColumns:function(e){var f=$(this.options.headerIdentifier,e);var d=20;var c=0;var b=[];var a=[];f.children().each(function(){var h=$(this);var g=h.outerWidth(true);d+=g;a[c]=(h.attr("rel")=="resized");b[c]=h.width();c++});f.css({width:d+"px"});$(this.options.rowIdentifier,e).each(function(){var h=$(this);var g=0;h.children().each(function(){var i=$(this);i.css({width:b[g]+"px"});if(a[g]){$(":input",i).each(function(){$(this).css({width:(b[g]-10)+"px"})})}g++});h.css({width:d+"px"})});if(f.width()>e.width()){if(this.options.verticalSlider){this.addVerticalSlider(e)}else{if($(this.options.rowIdentifier,e).size()>this.options.minRowSliderCount){this.addSlider(e,"before")}this.addSlider(e,"after")}}},addSlider:function(d,a){var c=this;var e=$(this.options.headerIdentifier,d);var b=$(document.createElement("div"));b.addClass("sliderContainer");if(a=="before"){d.before(b)}else{if(a=="after"){d.after(b)}}b.slider({value:1,min:1,max:e.width()-d.width(),step:1,slide:function(f,g){$(c.options.headerIdentifier+", "+c.options.rowIdentifier,d).css({"margin-left":(1-g.value)+"px"})}})},addVerticalSlider:function(d){var c=this;var e=$(this.options.headerIdentifier,d);var b=$(document.createElement("div")).addClass("verticalSliderContainer");var a=e.width()-d.width();d.before(b);b.slider({orientation:"vertical",value:a,min:1,max:a,step:1,slide:function(f,g){$(c.options.headerIdentifier+", "+c.options.rowIdentifier,d).css({"margin-left":(0-(a-g.value))+"px"})}})}};